<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Videollamada Administrador/Usuario</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }

        #login-form, #video-section {
            display: none;
        }

        #login-form.active, #video-section.active {
            display: block;
        }

        #videos-container {
            display: flex;
            justify-content: space-around;
            width: 100%;
        }

        video {
            width: 45%;
            height: auto;
            border: 1px solid #ccc;
            background: black;
        }

        button {
            margin: 10px;
            padding: 10px 20px;
            font-size: 16px;
        }
    </style>
</head>
<body>

    <div id="login-form" class="active">
        <h2>Iniciar sesión</h2>
        <form id="form">
            <label for="role">Tipo de usuario:</label>
            <select id="role">
                <option value="admin">Administrador</option>
                <option value="user">Usuario</option>
            </select><br><br>
            <label for="code">Contraseña:</label>
            <input type="password" id="code" required><br><br>
            <button type="submit">Iniciar Sesión</button>
        </form>
    </div>

    <div id="video-section">
        <h2>Videollamada</h2>
        <div id="videos-container">
            <video id="admin-video" autoplay playsinline></video>
            <video id="user-video" autoplay playsinline></video>
        </div>
    </div>

    <script>
        const adminCode = "1234";
        const userCode = "0987";

        const form = document.getElementById("form");
        const codeInput = document.getElementById("code");
        const roleSelect = document.getElementById("role");
        const videoSection = document.getElementById("video-section");
        const loginForm = document.getElementById("login-form");
        const adminVideo = document.getElementById("admin-video");
        const userVideo = document.getElementById("user-video");

        let isAdmin = false;
        let adminStream = null;
        let userStream = null;

        // Función para iniciar sesión
        form.addEventListener("submit", function (e) {
            e.preventDefault();
            const role = roleSelect.value;
            const code = codeInput.value;

            if (role === "admin" && code === adminCode) {
                isAdmin = true;
                loginForm.classList.remove("active");
                videoSection.classList.add("active");
                startVideo(true); // Iniciar video para administrador (con micrófono)
            } else if (role === "user" && code === userCode) {
                isAdmin = false;
                loginForm.classList.remove("active");
                videoSection.classList.add("active");
                startVideo(false); // Iniciar video para usuario (sin micrófono)
            } else {
                alert("Contraseña incorrecta.");
            }
        });

        // Función para iniciar el acceso a la cámara (con o sin micrófono)
        function startVideo(isAdmin) {
            const constraints = isAdmin ? { video: true, audio: true } : { video: true, audio: false };
            
            navigator.mediaDevices.getUserMedia(constraints)
                .then(function (stream) {
                    if (isAdmin) {
                        adminStream = stream;
                        adminVideo.srcObject = stream;
                    } else {
                        userStream = stream;
                        userVideo.srcObject = stream;
                    }
                    if (adminStream && userStream) {
                        displayBothVideos();
                    }
                })
                .catch(function (err) {
                    console.error("Error al acceder a la cámara o micrófono: ", err);
                });
        }

        // Mostrar ambos videos (una vez ambas conexiones estén listas)
        function displayBothVideos() {
            if (isAdmin) {
                adminVideo.srcObject = adminStream;
                userVideo.srcObject = userStream;
            } else {
                adminVideo.srcObject = adminStream;
                userVideo.srcObject = userStream;
            }
        }

        // Para simular la conexión de ambos roles en la misma página,
        // puedes usar esta función para iniciar ambos videos de forma local en la demo.
        // En un entorno real, necesitarías WebRTC para la transmisión de video entre usuarios.
    </script>

</body>
</html>
