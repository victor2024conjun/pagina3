<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Videollamada Administrador-Usuario</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 0;
        }
        #login-section, #admin-section, #user-section {
            display: none;
        }
        #login-section.active, #admin-section.active, #user-section.active {
            display: block;
        }
        video {
            width: 600px;
            height: 400px;
            border: 1px solid #ccc;
            background-color: black;
        }
        .question {
            margin: 20px 0;
        }
        .progress-bar {
            width: 600px;
            height: 20px;
            background-color: lightgray;
            margin: 5px 0;
        }
        .progress-bar-inner {
            height: 100%;
        }
        .yes-bar {
            background-color: green;
        }
        .no-bar {
            background-color: red;
        }
        button {
            margin: 5px;
            padding: 10px;
        }
        input[type="text"] {
            padding: 10px;
            width: 400px;
        }
    </style>
</head>
<body>

    <!-- Sección de inicio de sesión -->
    <div id="login-section" class="active">
        <h2>Iniciar Sesión</h2>
        <label for="role">Seleccione su rol:</label>
        <select id="role">
            <option value="admin">Administrador</option>
            <option value="user">Usuario</option>
        </select><br><br>
        <label for="password">Contraseña:</label>
        <input type="password" id="password"><br><br>
        <button id="login-btn">Iniciar Sesión</button>
    </div>

    <!-- Sección del administrador -->
    <div id="admin-section">
        <h2>Administrador - Videollamada</h2>
        <video id="admin-video" autoplay playsinline></video><br><br>
        <input type="text" id="question-input" placeholder="Escribe una pregunta...">
        <button id="send-question">Enviar Pregunta</button><br><br>
        <div id="questions-container"></div>
    </div>

    <!-- Sección del usuario -->
    <div id="user-section">
        <h2>Usuario - Videollamada</h2>
        <video id="user-video" autoplay playsinline></video><br><br>
        <div id="user-questions"></div>
    </div>

    <script>
        // Variables
        const passwordAdmin = "1234";
        const passwordUser = "0987";
        const loginSection = document.getElementById("login-section");
        const adminSection = document.getElementById("admin-section");
        const userSection = document.getElementById("user-section");
        const roleSelect = document.getElementById("role");
        const passwordInput = document.getElementById("password");
        const loginBtn = document.getElementById("login-btn");
        const adminVideo = document.getElementById("admin-video");
        const userVideo = document.getElementById("user-video");
        const questionInput = document.getElementById("question-input");
        const sendQuestionBtn = document.getElementById("send-question");
        const questionsContainer = document.getElementById("questions-container");
        const userQuestionsContainer = document.getElementById("user-questions");

        let userRole = "";

        // Función de inicio de sesión
        loginBtn.addEventListener("click", function() {
            const role = roleSelect.value;
            const password = passwordInput.value;

            if (role === "admin" && password === passwordAdmin) {
                userRole = "admin";
                loginSection.classList.remove("active");
                adminSection.classList.add("active");
                startAdminVideo();
            } else if (role === "user" && password === passwordUser) {
                userRole = "user";
                loginSection.classList.remove("active");
                userSection.classList.add("active");
                startUserVideo();
            } else {
                alert("Contraseña incorrecta.");
            }
        });

        // Función para iniciar la videollamada del administrador
        function startAdminVideo() {
            navigator.mediaDevices.getUserMedia({ video: true, audio: true })
                .then(function(stream) {
                    adminVideo.srcObject = stream;
                })
                .catch(function(err) {
                    console.error("Error al acceder a la cámara o micrófono: ", err);
                });
        }

        // Función para conectar la videollamada del usuario
        function startUserVideo() {
            navigator.mediaDevices.getUserMedia({ video: false, audio: false })
                .then(function(stream) {
                    // Aquí en un sistema real se transmitiría el stream del administrador al usuario
                    // Esto es una simulación
                    userVideo.srcObject = adminVideo.srcObject;
                })
                .catch(function(err) {
                    console.error("Error al conectar la videollamada: ", err);
                });
        }

        // Función para que el administrador envíe una pregunta
        sendQuestionBtn.addEventListener("click", function() {
            const questionText = questionInput.value;
            if (questionText.trim() !== "") {
                addQuestion(questionText);
                questionInput.value = "";
            }
        });

        // Función para añadir preguntas tanto al administrador como al usuario
        function addQuestion(questionText) {
            const questionElemAdmin = createQuestionElement(questionText, true);
            const questionElemUser = createQuestionElement(questionText, false);
            questionsContainer.appendChild(questionElemAdmin);
            userQuestionsContainer.appendChild(questionElemUser);
        }

        // Crear un elemento de pregunta con botones de sí/no y barras de progreso
        function createQuestionElement(questionText, isAdmin) {
            const questionDiv = document.createElement("div");
            questionDiv.className = "question";

            const questionTitle = document.createElement("h3");
            questionTitle.innerText = questionText;
            questionDiv.appendChild(questionTitle);

            const yesBtn = document.createElement("button");
            yesBtn.innerText = "Sí";
            yesBtn.addEventListener("click", function() {
                updateProgressBar(yesBar, 1);
                yesBtn.disabled = true;
                noBtn.disabled = true;
            });

            const noBtn = document.createElement("button");
            noBtn.innerText = "No";
            noBtn.addEventListener("click", function() {
                updateProgressBar(noBar, 1);
                yesBtn.disabled = true;
                noBtn.disabled = true;
            });

            if (!isAdmin) {
                questionDiv.appendChild(yesBtn);
                questionDiv.appendChild(noBtn);
            }

            // Barras de progreso
            const yesBar = document.createElement("div");
            yesBar.className = "progress-bar-inner yes-bar";
            const yesBarContainer = document.createElement("div");
            yesBarContainer.className = "progress-bar";
            yesBarContainer.appendChild(yesBar);

            const noBar = document.createElement("div");
            noBar.className = "progress-bar-inner no-bar";
            const noBarContainer = document.createElement("div");
            noBarContainer.className = "progress-bar";
            noBarContainer.appendChild(noBar);

            questionDiv.appendChild(yesBarContainer);
            questionDiv.appendChild(noBarContainer);

            return questionDiv;
        }

        // Función para actualizar la barra de progreso (máximo hasta 600)
        function updateProgressBar(bar, increment) {
            const currentWidth = parseFloat(bar.style.width) || 0;
            const newWidth = Math.min(currentWidth + increment * 100, 600);
            bar.style.width = newWidth + "px";
        }
    </script>

</body>
</html>
